---
import Layout from "../../layouts/PerformerLayout.astro";
import { Icon } from "astro-icon/components";
import data from "../../assets/data/data.json";
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

// Create static paths from the json data
export function getStaticPaths() {
  return data.map((performer, index) => ({
    params: {
      performer: performer.slug,
      image: performer.image,
      id: index,
      name: performer.name,
      bio: performer.bio,
      instagram: performer.instagram,
      website: performer.website,
    },
  }));
}

const { performer } = Astro.params;

// Code for the navigation
const performerIndex = data.findIndex((p) => p.slug === performer);
const performerData = data[performerIndex];

const previousPerformerIndex = (performerIndex - 1 + data.length) % data.length;
const nextPerformerIndex = (performerIndex + 1) % data.length;

const previousPerformer = data[previousPerformerIndex];
const nextPerformer = data[nextPerformerIndex];

// Import images dynamically
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/*.{jpeg,jpg,png,gif,webp}"
);
---

<Layout
  title={performerData?.name && performerData.pronouns
    ? `${performerData.name} (${performerData.pronouns})`
    : "Undefined"}
>
  <nav class="flex-col gap-2 items-center justify-center absolute right-8">
    {
      performerData?.instagram && (
        <a href={`https://instagram.com/${performerData.instagram}`}>
          <Icon name="mdi:instagram" class="text-2xl text-black" />
        </a>
      )
    }
  </nav>
  <header class="mb-4">
    <h2 class="font-display text-4xl mb-1 tracking-wide uppercase text-center">
      {performerData?.name}
    </h2>
    <p class="font-display text-center">({performerData?.pronouns})</p>
  </header>
  <section class="grid md:grid-cols-2 gap-x-8 gap-y-4 mb-8">

    {
      performerData?.image && (
        <img
          alt={`A headshot of ${performerData?.name}, looking directly at the camera`}
          src={`/src/assets/${performerData.image}.webp`}
          class="rounded w-3/4 border-2 border-blue md:justify-self-end justify-self-center shadow"
        />
      )
    }

    <section class="font-sans text-black text-lg leading-7">
      <section
        class="prose max-w-[60ch] md:justify-self-start justify-self-center mb-2 text-pretty"
        set:html={performerData?.bio}
      />
      <a class="underline" href={`https://${performerData?.website}`}
        >{performerData?.website && performerData.website}</a
      >
    </section>
  </section>
  <nav class="flex justify-between items-center mt-4">
    <button
      class="shadow p-2 rounded bg-darkpink border-blue border text-white"
    >
      <a
        href={`/performers/${previousPerformer.slug}`}
        class="flex items-center gap-2"
      >
        <Icon name="mdi:arrow-left" class="text-2xl text-white" />
        <span class="font-display">{previousPerformer.name}</span>
      </a>
    </button>
    <button
      class="shadow p-2 rounded bg-darkpink border-blue border text-white"
    >
      <a
        href={`/performers/${nextPerformer.slug}`}
        class="flex items-center gap-2"
      >
        <span class="font-display">{nextPerformer.name}</span>
        <Icon name="mdi:arrow-right" class="text-2xl text-white" />
      </a>
    </button>
  </nav>
</Layout>
